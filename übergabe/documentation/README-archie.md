Transfer - micro

A DATA TRANSFER TOOL designed to seamlessly connect the Rolls-Royce Network to the air-gapped microfilm processing system.


How to connect an air-gapped system to a secure enterprise network? Due to corporate security restrictions, any external systems cannot directly connect to the RR-Network via LAN. Therefore data transfer can happen only over Bluetooth or USB-Drive.

To simplify and automate these processes, we utilize several mechanics to initiate certain actions based on the location of the drive and its contents via the micro-system, like Hotfolders, Manifests, Reciepts (ACK).

Systems outlined here include archie (the micro-server instance on the RR-Network), the microfilm-transfer USB Drive, and micro (microfilm processing system). 

micro:

    imports: Project folder, PDF files, COM-List
    exports: Project data, DB, Xlsx files

archie:

    imports: Project data, DB, Xlsx files
    exports: Project folder, PDF files, COM-List



# Transfer directions:

A-B: RR > USB > micro

- PDF Files on the RR-Network that needs to be transferred to air-gapped microfilm processing system

B-A: micro > USB > RR

- Production data, Reports and Handoff data that needs to go back to the RR network

On both micro and RR, theres seperate instances of the transfer tooling, which handle their side of tasks.



# USB directory structure:

The name of the drive must be microfilm-transfer.


Two directional folders (A-B, B-A). The server instances will look for these folders only. Files outside these folders will be ignored:

microfilm-transfer/
    A-B/
        <transfer-id>/          Unique transfer id (generated by A)
            manifest.json       JSON holding meta and directory tree
            files/              Actual files
                ... 

    B-A/
        <transfer-id>/
            manifest.json
            files/
                ...
        





# Hotfolder (on RR-Network)

Root folder: Q:\DocumentManagement\Servicelines\Archivierung\Mikroverfilmung_in_OU\Verfilmung_Oberursel_Übergabe\

Hotfolders:

OU (Oberursel):
    Q:\DocumentManagement\Servicelines\Archivierung\Mikroverfilmung_in_OU\Verfilmung_Oberursel_Übergabe\Übergabe aus OU

DW (Dahlewitz): 

    Q:\DocumentManagement\Servicelines\Archivierung\Mikroverfilmung_in_OU\Verfilmung_Oberursel_Übergabe\Übergabe aus DW

Shortcuts in this folder will trigger preparation actions for the copy operation. Both locations are independent, but basically trigger the same actions in their respectful folders.

# Directory structure

This is how a perfect project directory structure looks like:

Übergabe aus OU/
    RRD001-2000_OU_FAIR/            <archive_id>
        PDF/                        <pdf_folder>
            1234567890123456.pdf    <document>
            ...
        COM-List.xlsx               <comlist>

So all we need is:

- A project folder containing:
    - A PDF folder containing:
        - Only PDF documents as listed in COMLIST
    - COMLIST with Barcodes (Documents-Filename) and COMIDs (Bildnummer) 

# Project folder validation rules:

Its only valid if:

1. Project folder
    - must follow this format:
    - RRDXXX-YYYY_LOCATION_DOCTYPE (archive_id)
        - RRDXXX-YYYY - Auftragsnummer (e.g. RRD001-2000, RRD101-2010, ...)
        - LOCATION - either OU or DW
        - DOCTYPE - any valid string (Rechnungen, Berichte, etc.)
    - since DOCTYPE can include "_", we need to carefully seperate
    - examples: RRD017-2024_OU_FAIR, RRD098-2023_DW_Montagebauakten_1
2. COM-List Excel file
    - .xlsx, .xls, .xlsm, .xlsb
    - Filename must include (by priority): "com", <archive-id>,  
    - Header row Barcode (A), Bildnummer (B)
    - Data rows 16-digits (A), 6-digits (B), continous progression, no duplicates
    - examples: RRD001-2025_Comliste.xlsx, COM-Liste.xls, COMLIST.xlsx
3. PDF-Folder
    - only .pdf, .PDF files
    - filenames must match Barcode in COM-List
    - files needs to match Barcode list
    - Folder name must include (by priority): "pdf", <archive-id>
        - special rule: folder "importiert" also allowed, but if theres two possible pdf folders (both importiert and pdf, with close match), always use pdf
    - examples: PDF, PDFs zu RRD002-2024, pdfs, PDFs, PDF's zu RRD002-2024
    - examples: 1422003101381720.pdf, 1422003101381721.PDF
4. PDF integrity
    - PDF is valid and not corrupted
    - Filesize not 0KB
    - (Check if corrupted, can we open it?)



microdaemon

This daemon is responsible for monitoring the Hotfolders and preparing the necessary data needed for transfer. 

- Traverses the handover directory and creates a directory tree
- Continously and silently monitors folder/file changes
- creates SHA-checksums for file integrity checks
- creates manifest.json per folder
- Verifies validity of folders (by criteria)

# Directory Traversal processing steps




# Directory hot folder processing steps

Automated processing at source 

0. Directory tree discovery
    - Create a tree of the source directory to check against the COM-List
    - Zero byte sentinel as project readyness marker ()
    - 