<!-- Film Index Generation Component -->
<div class="index-component" id="step-4">
    <!-- Index Status Header -->
    <div class="index-status">
        <div class="status-container">
            <h3 class="section-title">Film Index Generation</h3>
            <div class="status-badge pending" id="index-status-badge">
                <i class="fas fa-clock"></i>
                <span>Awaiting Index Generation</span>
            </div>
        </div>
        <div class="index-actions">
            <button class="btn secondary" id="reset-index">
                <i class="fas fa-redo"></i> Reset
            </button>
            <button class="btn primary" id="generate-index">
                <i class="fas fa-file-alt"></i> Generate Index
            </button>
        </div>
    </div>

    <!-- Project Overview Panel -->
    <div class="panel project-overview">
        <div class="panel-header">
            <h4><i class="fas fa-info-circle"></i> Project Overview</h4>
        </div>
        <div class="panel-content">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Project ID:</span>
                    <span class="info-value" id="project-id">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Archive ID:</span>
                    <span class="info-value" id="archive-id">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Documents:</span>
                    <span class="info-value" id="document-count">0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Film Rolls (16mm):</span>
                    <span class="info-value" id="roll-count-16mm">0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- COM List Information Panel -->
    <div class="panel com-list-panel">
        <div class="panel-header">
            <h4><i class="fas fa-file-excel"></i> COM List Information</h4>
        </div>
        <div class="panel-content">
            <div class="com-list-info">
                <div class="info-item">
                    <span class="info-label">COM List Path:</span>
                    <span class="info-value" id="com-list-path">-</span>
                </div>
                <div class="status-info">
                    <div class="com-list-status" id="com-list-status">Loading COM list information...</div>
                </div>
                <div class="note">
                    <p><i class="fas fa-info-circle"></i> The COM list is loaded from project settings. If no COM list is available, placeholder IDs will be used.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Index Generation Panel -->
    <div class="panel index-generation-panel">
        <div class="panel-header">
            <h4><i class="fas fa-cogs"></i> Index Generation</h4>
        </div>
        <div class="panel-content">
            <div class="generation-info">
                <p>This will create an initial index for your 16mm film documents. COM IDs will be applied based on your COM list if available.</p>
                <div class="generation-status" id="generation-status">
                    Status: Not started
                </div>
            </div>
        </div>
    </div>

    <!-- Index Preview Panel -->
    <div class="panel index-preview-panel hidden" id="index-preview-panel">
        <div class="panel-header with-actions">
            <h4><i class="fas fa-table"></i> Document Index</h4>
            <div class="panel-actions">
                <button class="action-button" id="download-csv" title="Download as CSV">
                    <i class="fas fa-download"></i>
                </button>
            </div>
        </div>
        <div class="panel-content">
            <div class="table-container">
                <table class="data-table" id="index-table">
                    <thead>
                        <tr>
                            <th>Document ID</th>
                            <th>COM ID</th>
                            <th>Roll</th>
                            <th>Frames</th>
                            <th>Final Index</th>
                        </tr>
                    </thead>
                    <tbody id="index-table-body">
                        <!-- Index entries will be added here dynamically -->
                    </tbody>
                </table>
            </div>
            <div class="table-pagination">
                <span id="table-info">Showing 0 of 0 entries</span>
            </div>
        </div>
    </div>

    <!-- Film Number Update Panel -->
    <div class="panel film-number-panel hidden" id="film-number-panel">
        <div class="panel-header">
            <h4><i class="fas fa-tag"></i> Update Index with Film Numbers</h4>
        </div>
        <div class="panel-content">
            <div class="update-info">
                <p>Film numbers have been assigned to rolls. Update the index with these film numbers?</p>
                <button class="btn primary" id="update-index">
                    <i class="fas fa-sync"></i> Update Index
                </button>
                <div class="update-status" id="update-status">
                    Status: Not updated
                </div>
            </div>
        </div>
    </div>

    <!-- Final Index Panel -->
    <div class="panel final-index-panel hidden" id="final-index-panel">
        <div class="panel-header with-actions">
            <h4><i class="fas fa-check-circle"></i> Final Index</h4>
            <div class="panel-actions">
                <button class="action-button" id="export-json" title="Export as JSON">
                    <i class="fas fa-file-code"></i>
                </button>
                <button class="action-button" id="download-final-csv" title="Download as CSV">
                    <i class="fas fa-file-csv"></i>
                </button>
            </div>
        </div>
        <div class="panel-content">
            <div class="final-stats">
                <div class="stat-item">
                    <span class="stat-label">Total entries:</span>
                    <span class="stat-value" id="total-entries">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Updated:</span>
                    <span class="stat-value" id="updated-entries">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Missing film numbers:</span>
                    <span class="stat-value" id="missing-entries">0</span>
                </div>
            </div>
            <div class="table-container">
                <table class="data-table" id="final-index-table">
                    <thead>
                        <tr>
                            <th>Document ID</th>
                            <th>COM ID</th>
                            <th>Roll</th>
                            <th>Final Index</th>
                        </tr>
                    </thead>
                    <tbody id="final-index-table-body">
                        <!-- Final index entries will be added here dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Raw Index Data Panel (Collapsible) -->
    <div class="panel index-data-panel">
        <div class="panel-header with-actions">
            <h4><i class="fas fa-code"></i> Index Data</h4>
            <div class="panel-actions">
                <button class="action-button" id="toggle-data-panel" title="Toggle panel">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
        </div>
        <div class="panel-content hidden" id="index-data-content">
            <pre id="index-data-json" class="json-viewer">{}</pre>
        </div>
    </div>
</div>

<!-- Index Progress Modal -->
<div class="modal fade" id="index-progress-modal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Generating Film Index</h5>
            </div>
            <div class="modal-body">
                <div class="progress-container">
                    <div class="progress">
                        <div class="progress-bar" id="index-progress-bar" style="width: 0%"></div>
                    </div>
                    <div class="progress-text">
                        <span id="index-progress-text">Starting index generation...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="workflow-navigation">
    <button class="nav-button back" id="back-to-allocation">
        <i class="fas fa-arrow-left"></i>
        Back to Allocation
    </button>
    <button class="nav-button next" id="to-step-5" disabled>
        Continue to Film Number Assignment
        <i class="fas fa-arrow-right"></i>
    </button>
</div>