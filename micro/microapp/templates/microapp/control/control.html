{% extends 'microapp/base.html' %}

{% block title %}Control Panel - Microfilm Processing System{% endblock %}

{% load static %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'microapp/css/control/header.css' %}">
    <link rel="stylesheet" href="{% static 'microapp/css/control/control.css' %}">
    <link rel="stylesheet" href="{% static 'microapp/css/control/control_panel.css' %}">
    <link rel="stylesheet" href="{% static 'microapp/css/control/control_panel_sma.css' %}">
    <link rel="stylesheet" href="{% static 'microapp/css/control/control_panel_esp.css' %}">
    <link rel="stylesheet" href="{% static 'microapp/css/control/filming_machine.css' %}">
    <link rel="stylesheet" href="{% static 'microapp/css/control/developer_machine.css' %}">
    <link rel="stylesheet" href="{% static 'microapp/css/control/system_panel.css' %}">
{% endblock %}

{% block content %}
    <div class="control-container">
        {% include 'microapp/control/header.html' %}
        {% include 'microapp/control/control_panel.html' %}
        {% include 'microapp/control/filming_machine.html' %}
        {% include 'microapp/control/developer_machine.html' %}
        {% include 'microapp/control/system_panel.html' %}       
        {% csrf_token %}
    </div>
{% endblock %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Refactored modular scripts in dependency order -->
    <!-- Core utilities first -->
    <script src="{% static 'microapp/js/control/utils.js' %}"></script>
    <script src="{% static 'microapp/js/control/notification_manager.js' %}"></script>
    
    <!-- Connection management next -->
    <script src="{% static 'microapp/js/control/connection_manager.js' %}"></script>
    
    <!-- Core control modules that depend on connection and utils -->
    <script src="{% static 'microapp/js/control/machine_controls.js' %}"></script>
    <script src="{% static 'microapp/js/control/relay_controls.js' %}"></script>
    
    <!-- UI and visualization modules -->
    <script src="{% static 'microapp/js/control/ui_manager.js' %}"></script>
    <script src="{% static 'microapp/js/control/chart_manager.js' %}"></script>
    
    <!-- External systems management -->
    <script src="{% static 'microapp/js/control/external_systems_manager.js' %}"></script>
    
    <!-- Main controller script (loads last) -->
    <script src="{% static 'microapp/js/control/control_main.js' %}"></script>
{% endblock %}