{% extends 'microapp/base.html' %}
{% load static %}

{% block title %}Label Management{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'microapp/css/label/label.css' %}">
{% endblock %}

{% block content %}
<!-- CSRF Token -->
{% csrf_token %}

<div class="label-container">
    <!-- Header -->
    <div class="label-header">
        <h1>Label Management</h1>
        <p>Generate new labels for uncompleted rolls, or view and manage existing labels for completed rolls. Each section handles different workflows for optimal organization.</p>
    </div>

    <!-- Notifications Container -->
    <div id="notifications-container" class="notifications-container"></div>

    <!-- Roll Labels Section -->
    <div class="label-section">
        <div class="section-header">
            <h2>
                <i class="fas fa-plus-circle"></i>
                Generate New Labels
            </h2>
            <div class="section-actions">
                <button id="refresh-uncompleted-rolls" class="btn btn-outline btn-small">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button id="select-all-uncompleted" class="btn btn-secondary btn-small">
                    <i class="fas fa-check-square"></i> Select All
                </button>
                <button id="clear-uncompleted-selection" class="btn btn-outline btn-small">
                    <i class="fas fa-square"></i> Clear
                </button>
            </div>
        </div>
        
        <div class="selection-info">
            <span id="uncompleted-selection-count">0 rolls selected</span>
            <button id="generate-uncompleted" class="btn btn-primary" disabled>
                <i class="fas fa-file-pdf"></i> Generate Labels (Both Versions)
            </button>
        </div>
        
        <div id="uncompleted-rolls-grid" class="rolls-grid">
            <!-- Uncompleted rolls will be loaded here -->
            <div class="loading-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading rolls ready for label generation...</p>
            </div>
        </div>
    </div>

    <!-- Completed Labels Management Section -->
    <div class="label-section">
        <div class="section-header">
            <h2>
                <i class="fas fa-eye"></i>
                View Existing Labels
            </h2>
            <div class="section-actions">
                <button id="refresh-completed-rolls" class="btn btn-outline btn-small">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button id="select-all-completed" class="btn btn-secondary btn-small">
                    <i class="fas fa-check-square"></i> Select All
                </button>
                <button id="clear-completed-selection" class="btn btn-outline btn-small">
                    <i class="fas fa-square"></i> Clear
                </button>
            </div>
        </div>
        
        <div class="selection-info">
            <span id="completed-selection-count">0 rolls selected</span>
            <button id="view-completed-labels" class="btn btn-secondary" disabled>
                <i class="fas fa-eye"></i> View Selected Labels
            </button>
        </div>
        
        <div id="completed-rolls-grid" class="rolls-grid">
            <!-- Completed rolls will be loaded here -->
            <div class="loading-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading rolls with existing labels...</p>
            </div>
        </div>
    </div>

    <!-- Generated Labels Section -->
    <div class="label-section">
        <div class="section-header">
            <h2>
                <i class="fas fa-file-pdf"></i>
                Generated Labels
            </h2>
            <div class="section-actions">
                <button id="show-all-labels" class="btn btn-secondary btn-small">
                    <i class="fas fa-list"></i> Show All Labels
                </button>
                <button id="clear-generated" class="btn btn-outline btn-small">
                    <i class="fas fa-trash"></i> Clear All
                </button>
            </div>
        </div>
        
        <div id="generated-labels" class="generated-labels">
            <!-- Generated labels will appear here -->
            <div class="empty-state">
                <i class="fas fa-file-pdf"></i>
                <p>No labels generated yet</p>
                <small>Select rolls above and click "Generate Labels"</small>
            </div>
        </div>
    </div>

    <!-- Printer Status Section -->
    <div class="label-section">
        <div class="section-header">
            <h2>
                <i class="fas fa-print"></i>
                Printer Status
            </h2>
        </div>
        
        <div class="print-info">
            <div class="printer-status">
                <i class="fas fa-printer"></i>
                <span id="printer-status-text">Printing Method: Server-Side Direct Printing</span>
                <small id="printer-details">Checking printer status...</small>
            </div>
            <div class="print-instructions">
                <h4>Server-Side Printing Features:</h4>
                <ul>
                    <li><strong>Direct Printing:</strong> Labels print automatically to the default printer</li>
                    <li><strong>No User Interaction:</strong> No print dialogs or manual printer selection required</li>
                    <li><strong>Automatic Status:</strong> Labels are marked as printed automatically</li>
                    <li><strong>Individual Control:</strong> Download and print each version separately</li>
                    <li><strong>Version Support:</strong> Both Normal and Angled versions available per roll</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'microapp/js/label/label.js' %}"></script>
{% endblock %} 