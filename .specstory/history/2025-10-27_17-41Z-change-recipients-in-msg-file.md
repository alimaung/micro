<!-- Generated by SpecStory, Markdown v2.0.0 -->

<!-- cursor Session 8a30c458-fa19-4a8d-a27d-2a0463aeedaf (2025-10-27 17:41Z) -->

# Change recipients in .msg file (2025-10-27 17:41Z)

_**User (2025-10-27 16:55Z)**_

@recipient_changer.py is it possible to change recipients of a .msg file?

---

_**Agent (model claude-4.5-sonnet, mode Agent)**_

I'll help you explore whether it's possible to change recipients of a .msg file. Let me first check the current state of the file and then research the available options.

---

File seems to be binary and cannot be opened as text

---

<tool-use data-tool-type="search" data-tool-name="web_search">
<details>
            <summary>Tool use: **web_search** ‚Ä¢ Searched web `python change recipients .msg file outlook message` ‚Ä¢ **1** results</summary>
        
| Title | URL | Chunk |
|-------|-----|-------|
| Web Search Results |  | Yes, it is possible to change the recipients of a `.msg` file using Python. While I couldn't find a specific script named `recipient_changer.py`, there are Python libraries that allow you to modify `.msg` files, including their recipient lists.<br/><br/>One such library is `msg_parser`, which enables parsing and converting Microsoft Outlook `.msg` files. With this library, you can load a `.msg` file, modify its properties (including recipients), and save the changes. Here's an example of how you might use it:<br/><br/><br/>```python<br/>from msg_parser import MsOxMessage<br/><br/># Load the .msg file<br/>msg = MsOxMessage('path_to_msg_file.msg')<br/><br/># Access the recipient list<br/>recipients = msg.get_recipients()<br/><br/># Modify the recipient list as needed<br/># For example, to add a new recipient:<br/>new_recipient = \{<br/>    'display_name': 'New Recipient',<br/>    'email_address': '[email¬†protected]',<br/>    'recipient_type': 'to'  # 'to', 'cc', or 'bcc'<br/>\}<br/>recipients.append(new_recipient)<br/><br/># Set the modified recipient list back to the message<br/>msg.set_recipients(recipients)<br/><br/># Save the modified .msg file<br/>msg.save('modified_msg_file.msg')<br/>```<br/><br/><br/>Please note that the exact methods and attributes may vary depending on the library's implementation. It's advisable to refer to the library's documentation for detailed usage instructions.<br/><br/>Another library you might consider is `python-oxmsg`, which allows parsing of Outlook `.msg` files to extract email messages and attachments. While its primary focus is on extraction, it may offer functionalities that can be adapted for modifying recipient information.<br/><br/>Keep in mind that modifying `.msg` files programmatically requires a good understanding of the file's structure and the library's API. Always ensure to test your modifications to verify that the changes are applied correctly. |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="web_search">
<details>
            <summary>Tool use: **web_search** ‚Ä¢ Searched web `python extract-msg pywin32 modify msg file recipients` ‚Ä¢ **1** results</summary>
        
| Title | URL | Chunk |
|-------|-----|-------|
| Web Search Results |  | I couldn't locate a script named `recipient_changer.py` in the available sources. However, modifying the recipients of a `.msg` file is feasible using various tools and libraries.<br/><br/>**Using Python Libraries:**<br/><br/>1. **msg_parser**: This Python module allows parsing and converting Microsoft Outlook `.msg` files. While it primarily focuses on reading and converting `.msg` files, you can extract the message content, modify the recipient details, and save the changes. Installation is straightforward:<br/><br/>   ```bash<br/>   pip install msg_parser<br/>   ```<br/><br/><br/>   For more details, visit the GitHub repository: ([github.com](https://github.com/vikramarsid/msg_parser?utm_source=openai))<br/><br/>2. **python-oxmsg**: This library enables parsing Outlook `.msg` files to extract email messages and attachments. It doesn't support modifying messages directly, but you can extract the content, adjust the recipients, and create a new `.msg` file with the updated information. Installation:<br/><br/>   ```bash<br/>   pip install python-oxmsg<br/>   ```<br/><br/><br/>   More information is available on their GitHub page: ([github.com](https://github.com/scanny/python-oxmsg?utm_source=openai))<br/><br/>3. **extract-msg**: This package extracts emails and attachments from `.msg` files. Similar to the above libraries, it focuses on extraction rather than modification. However, you can use it to read the message, change the recipients, and save the modified content. Installation:<br/><br/>   ```bash<br/>   pip install extract-msg<br/>   ```<br/><br/><br/>   For more details, refer to their GitHub repository: ([github.com](https://github.com/TeamMsgExtractor/msg-extractor?utm_source=openai))<br/><br/>**Using C# with Aspose.Email:**<br/><br/>If you're comfortable with C#, the Aspose.Email library provides functionalities to edit `.msg` files, including modifying recipients. Here's a sample code snippet:<br/><br/><br/>```csharp<br/>// Load the MSG file<br/>var msg = MapiMessage.Load("sample-email.msg");<br/><br/>// Clear existing recipients<br/>msg.Recipients.Clear();<br/><br/>// Add new "To" recipient<br/>msg.Recipients.Add("newrecipient@example.com", "New Recipient", MapiRecipientType.MAPI_TO);<br/><br/>// Add "CC" recipient<br/>msg.Recipients.Add("ccrecipient@example.com", "CC Recipient", MapiRecipientType.MAPI_CC);<br/><br/>// Add "BCC" recipient<br/>msg.Recipients.Add("bccrecipient@example.com", "BCC Recipient", MapiRecipientType.MAPI_BCC);<br/><br/>// Save the updated MSG file<br/>msg.Save("updated-email-with-new-recipients.msg");<br/>```<br/><br/><br/>This example demonstrates loading an existing `.msg` file, clearing its recipients, adding new ones, and saving the changes. For more details, refer to the GitHub Gist: ([gist.github.com](https://gist.github.com/aspose-com-gists/a9cbf6cd376614a723be8be94d6e4230?utm_source=openai))<br/><br/>**Using PowerShell:**<br/><br/>For those familiar with PowerShell, there's a cmdlet available for converting `.msg` files, which can be adapted to modify recipient information. The script is available on GitHub: ([gist.github.com](https://gist.github.com/njm2112/8259c86c7eebc8b5595531f610ba5ede?utm_source=openai))<br/><br/>**Considerations:**<br/><br/>- **Backup Original Files**: Always create backups of your original `.msg` files before making modifications.<br/><br/>- **Test Thoroughly**: After modifying the recipients, test the `.msg` files to ensure they function as expected in your email client.<br/><br/>- **Library Limitations**: Some libraries focus on reading and extracting data from `.msg` files and may not support direct modification. In such cases, extract the content, modify it, and create a new `.msg` file with the updated information.<br/><br/>By leveraging these tools and libraries, you can effectively change the recipients of a `.msg` file. |

</details>
</tool-use>

---

Yes, it is **possible** to change recipients of a .msg file! There are several Python libraries that can help you accomplish this:

## Best Options:

### 1. **Using `pywin32` (Recommended for Windows)**
Since you're on Windows, you can use the `pywin32` library to manipulate Outlook MSG files through COM automation:

```python
import win32com.client

def change_msg_recipients(msg_path, new_recipients):
    """
    Change recipients of a .msg file
    
    Args:
        msg_path: Path to the .msg file
        new_recipients: Dict with 'to', 'cc', 'bcc' lists
                       e.g., {'to': ['user@example.com'], 'cc': [], 'bcc': []}
    """
    outlook = win32com.client.Dispatch("Outlook.Application")
    msg = outlook.CreateItemFromTemplate(msg_path)
    
    # Clear existing recipients
    while msg.Recipients.Count > 0:
        msg.Recipients.Remove(1)
    
    # Add new TO recipients
    for recipient in new_recipients.get('to', []):
        msg.Recipients.Add(recipient)
        msg.Recipients.Item(msg.Recipients.Count).Type = 1  # 1 = To
    
    # Add new CC recipients
    for recipient in new_recipients.get('cc', []):
        msg.Recipients.Add(recipient)
        msg.Recipients.Item(msg.Recipients.Count).Type = 2  # 2 = CC
    
    # Add new BCC recipients
    for recipient in new_recipients.get('bcc', []):
        msg.Recipients.Add(recipient)
        msg.Recipients.Item(msg.Recipients.Count).Type = 3  # 3 = BCC
    
    # Resolve all recipients
    msg.Recipients.ResolveAll()
    
    # Save the modified message
    msg.SaveAs(msg_path)
    msg.Close(0)  # 0 = olDiscard (don't save again)
```

### 2. **Using `extract-msg` library**
This is a pure Python solution that doesn't require Outlook to be installed:

```python
import extract_msg

def view_msg_recipients(msg_path):
    """Read recipients from a .msg file"""
    msg = extract_msg.Message(msg_path)
    print(f"To: {msg.to}")
    print(f"CC: {msg.cc}")
    print(f"BCC: {msg.bcc}")
    msg.close()
```

**Note**: `extract-msg` is primarily for reading. For writing/modifying, you'd need to use it in combination with other libraries or use `pywin32`.

### 3. **Using `msg-parser` or `python-oxmsg`**
These can parse MSG files but have limited modification capabilities.

## Recommendation:

For your use case with the file `RRD081-2024_handoff_2710251835.msg`, I'd recommend using **`pywin32`** since you're on Windows. This gives you full control over the MSG file format.

Would you like me to create a complete implementation in `recipient_changer.py` that can change the recipients of your MSG file?

---

_**User (2025-10-27 16:55Z)**_

yes pywin32.

if recipients in to, cc or bcc is ali.maung@*

change it to:

DEFAULT_EMAIL_RECIPIENTS = {
    'to': 'Dilek.kursun@rolls-royce.com', 
    'cc': 'jan.becker@rolls-royce.com; thomas.lux@rolls-royce.com',
    'bcc': 'michael.wuske@rolls-royce.com; tetiana.isakii@rolls-royce.com; shmaila.aslam@rolls-royce.com'
}


---

_**Agent (model claude-4.5-sonnet, mode Agent)**_

I'll create a complete implementation using `pywin32` that changes any recipient matching "ali.maung@*" to your specified default recipients.

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **code_edit** ‚Ä¢ Edit file: outlook/recipient_changer.py</summary>

**Chunk 1**
Lines added: 290, lines removed: 1

```diff
@@ -1,1 +1,290 @@
- 
+ &quot;&quot;&quot;
+ Outlook MSG Recipient Changer
+ Changes recipients in .msg files, specifically replacing ali.maung@* addresses
+ with default Rolls-Royce email recipients.
+ 
+ Requires: pywin32 (pip install pywin32)
+ &quot;&quot;&quot;
+ 
+ import win32com.client
+ import os
+ import sys
+ 
+ # Default recipients to use when replacing ali.maung@* addresses
+ DEFAULT_EMAIL_RECIPIENTS = {
+     &#39;to&#39;: &#39;Dilek.kursun@rolls-royce.com&#39;, 
+     &#39;cc&#39;: &#39;jan.becker@rolls-royce.com; thomas.lux@rolls-royce.com&#39;,
+     &#39;bcc&#39;: &#39;michael.wuske@rolls-royce.com; tetiana.isakii@rolls-royce.com; shmaila.aslam@rolls-royce.com&#39;
+ }
+ 
+ 
+ def should_replace_recipient(email_address):
+     &quot;&quot;&quot;
+     Check if a recipient email should be replaced.
+     Returns True if the email matches ali.maung@* pattern.
+     
+     Args:
+         email_address: Email address to check
+         
+     Returns:
+         bool: True if should be replaced, False otherwise
+     &quot;&quot;&quot;
+     if not email_address:
+         return False
+     
+     email_lower = email_address.lower()
+     return email_lower.startswith(&#39;ali.maung@&#39;)
+ 
+ 
+ def get_recipient_email(recipient):
+     &quot;&quot;&quot;
+     Extract email address from a recipient object.
+     
+     Args:
+         recipient: Outlook recipient object
+         
+     Returns:
+         str: Email address
+     &quot;&quot;&quot;
+     try:
+         # Try to get the SMTP address
+         if recipient.AddressEntry.Type == &quot;SMTP&quot;:
+             return recipient.Address
+         else:
+             # For Exchange addresses, try to get SMTP address
+             try:
+                 return recipient.AddressEntry.GetExchangeUser().PrimarySmtpAddress
+             except:
+                 return recipient.Address
+     except:
+         return recipient.Address
+ 
+ 
+ def change_msg_recipients(msg_path, output_path=None, dry_run=False):
+     &quot;&quot;&quot;
+     Change recipients in a .msg file if they match ali.maung@* pattern.
+     
+     Args:
+         msg_path: Path to the input .msg file
+         output_path: Path to save the modified .msg file (if None, overwrites original)
+         dry_run: If True, only print what would be changed without saving
+         
+     Returns:
+         dict: Information about the changes made
+     &quot;&quot;&quot;
+     if not os.path.exists(msg_path):
+         raise FileNotFoundError(f&quot;MSG file not found: {msg_path}&quot;)
+     
+     # Make path absolute
+     msg_path = os.path.abspath(msg_path)
+     if output_path:
+         output_path = os.path.abspath(output_path)
+     else:
+         output_path = msg_path
+     
+     print(f&quot;\nProcessing: {msg_path}&quot;)
+     print(&quot;-&quot; * 80)
+     
+     # Initialize Outlook
+     outlook = win32com.client.Dispatch(&quot;Outlook.Application&quot;)
+     
+     # Load the MSG file
+     msg = outlook.CreateItemFromTemplate(msg_path)
+     
+     # Collect information about current recipients
+     original_recipients = {
+         &#39;to&#39;: [],
+         &#39;cc&#39;: [],
+         &#39;bcc&#39;: []
+     }
+     
+     recipients_to_remove = []
+     found_ali_maung = False
+     
+     print(&quot;\nCurrent Recipients:&quot;)
+     for i in range(1, msg.Recipients.Count + 1):
+         recipient = msg.Recipients.Item(i)
+         email = get_recipient_email(recipient)
+         recipient_type = recipient.Type
+         
+         # Map type to category
+         type_name = {1: &#39;to&#39;, 2: &#39;cc&#39;, 3: &#39;bcc&#39;}.get(recipient_type, &#39;unknown&#39;)
+         
+         original_recipients[type_name].append(email)
+         print(f&quot;  [{type_name.upper()}] {recipient.Name} &lt;{email}&gt;&quot;)
+         
+         # Check if this recipient should be replaced
+         if should_replace_recipient(email):
+             recipients_to_remove.append(i)
+             found_ali_maung = True
+             print(f&quot;    ‚ö†Ô∏è  Will be removed (matches ali.maung@*)&quot;)
+     
+     if not found_ali_maung:
+         print(&quot;\n‚úì No ali.maung@* recipients found. No changes needed.&quot;)
+         msg.Close(0)  # Close without saving
+         return {
+             &#39;changed&#39;: False,
+             &#39;reason&#39;: &#39;No ali.maung@* recipients found&#39;,
+             &#39;original_recipients&#39;: original_recipients
+         }
+     
+     if dry_run:
+         print(&quot;\nüîç DRY RUN - No changes will be saved&quot;)
+         print(&quot;\nWould remove these recipients:&quot;)
+         for idx in recipients_to_remove:
+             recipient = msg.Recipients.Item(idx)
+             email = get_recipient_email(recipient)
+             print(f&quot;  - {recipient.Name} &lt;{email}&gt;&quot;)
+         
+         print(&quot;\nWould add these recipients:&quot;)
+         for recipient_type, addresses in DEFAULT_EMAIL_RECIPIENTS.items():
+             if addresses:
+                 print(f&quot;  [{recipient_type.upper()}] {addresses}&quot;)
+         
+         msg.Close(0)
+         return {
+             &#39;changed&#39;: False,
+             &#39;reason&#39;: &#39;Dry run - no changes saved&#39;,
+             &#39;would_remove&#39;: len(recipients_to_remove),
+             &#39;original_recipients&#39;: original_recipients
+         }
+     
+     # Remove recipients in reverse order to avoid index shifting
+     print(&quot;\n‚úèÔ∏è  Removing ali.maung@* recipients...&quot;)
+     for idx in reversed(recipients_to_remove):
+         recipient = msg.Recipients.Item(idx)
+         email = get_recipient_email(recipient)
+         print(f&quot;  Removed: {recipient.Name} &lt;{email}&gt;&quot;)
+         msg.Recipients.Remove(idx)
+     
+     # Add new recipients
+     print(&quot;\n‚úèÔ∏è  Adding new recipients...&quot;)
+     
+     # Add TO recipients
+     if DEFAULT_EMAIL_RECIPIENTS[&#39;to&#39;]:
+         for email in DEFAULT_EMAIL_RECIPIENTS[&#39;to&#39;].split(&#39;;&#39;):
+             email = email.strip()
+             if email:
+                 recipient = msg.Recipients.Add(email)
+                 recipient.Type = 1  # 1 = To
+                 print(f&quot;  Added [TO]: {email}&quot;)
+     
+     # Add CC recipients
+     if DEFAULT_EMAIL_RECIPIENTS[&#39;cc&#39;]:
+         for email in DEFAULT_EMAIL_RECIPIENTS[&#39;cc&#39;].split(&#39;;&#39;):
+             email = email.strip()
+             if email:
+                 recipient = msg.Recipients.Add(email)
+                 recipient.Type = 2  # 2 = CC
+                 print(f&quot;  Added [CC]: {email}&quot;)
+     
+     # Add BCC recipients
+     if DEFAULT_EMAIL_RECIPIENTS[&#39;bcc&#39;]:
+         for email in DEFAULT_EMAIL_RECIPIENTS[&#39;bcc&#39;].split(&#39;;&#39;):
+             email = email.strip()
+             if email:
+                 recipient = msg.Recipients.Add(email)
+                 recipient.Type = 3  # 3 = BCC
+                 print(f&quot;  Added [BCC]: {email}&quot;)
+     
+     # Resolve all recipients
+     print(&quot;\nüîÑ Resolving recipients...&quot;)
+     if not msg.Recipients.ResolveAll():
+         print(&quot;  ‚ö†Ô∏è  Warning: Not all recipients could be resolved&quot;)
+     
+     # Save the modified message
+     print(f&quot;\nüíæ Saving to: {output_path}&quot;)
+     msg.SaveAs(output_path)
+     msg.Close(0)  # Close without saving again
+     
+     print(&quot;\n‚úì Successfully updated recipients!&quot;)
+     print(&quot;-&quot; * 80)
+     
+     return {
+         &#39;changed&#39;: True,
+         &#39;removed_count&#39;: len(recipients_to_remove),
+         &#39;original_recipients&#39;: original_recipients,
+         &#39;output_path&#39;: output_path
+     }
+ 
+ 
+ def main():
+     &quot;&quot;&quot;Main entry point for the script.&quot;&quot;&quot;
+     import argparse
+     
+     parser = argparse.ArgumentParser(
+         description=&#39;Change recipients in Outlook .msg files&#39;,
+         formatter_class=argparse.RawDescriptionHelpFormatter,
+         epilog=&quot;&quot;&quot;
+ Examples:
+   # Process a single MSG file (overwrites original)
+   python recipient_changer.py message.msg
+   
+   # Process and save to a new file
+   python recipient_changer.py message.msg -o modified_message.msg
+   
+   # Dry run to see what would change
+   python recipient_changer.py message.msg --dry-run
+   
+   # Process all MSG files in a directory
+   python recipient_changer.py outlook/*.msg
+         &quot;&quot;&quot;
+     )
+     
+     parser.add_argument(
+         &#39;msg_files&#39;,
+         nargs=&#39;+&#39;,
+         help=&#39;Path to .msg file(s) to process&#39;
+     )
+     
+     parser.add_argument(
+         &#39;-o&#39;, &#39;--output&#39;,
+         help=&#39;Output path for the modified file (only works with single input file)&#39;
+     )
+     
+     parser.add_argument(
+         &#39;--dry-run&#39;,
+         action=&#39;store_true&#39;,
+         help=&#39;Show what would be changed without saving&#39;
+     )
+     
+     args = parser.parse_args()
+     
+     # Validate arguments
+     if args.output and len(args.msg_files) &gt; 1:
+         print(&quot;Error: --output can only be used with a single input file&quot;)
+         sys.exit(1)
+     
+     # Process each file
+     results = []
+     for msg_file in args.msg_files:
+         try:
+             result = change_msg_recipients(
+                 msg_file,
+                 output_path=args.output,
+                 dry_run=args.dry_run
+             )
+             results.append((msg_file, result, None))
+         except Exception as e:
+             print(f&quot;\n‚ùå Error processing {msg_file}: {str(e)}&quot;)
+             results.append((msg_file, None, str(e)))
+     
+     # Print summary
+     if len(results) &gt; 1:
+         print(&quot;\n&quot; + &quot;=&quot; * 80)
+         print(&quot;SUMMARY&quot;)
+         print(&quot;=&quot; * 80)
+         
+         changed = sum(1 for _, r, e in results if r and r.get(&#39;changed&#39;))
+         unchanged = sum(1 for _, r, e in results if r and not r.get(&#39;changed&#39;))
+         errors = sum(1 for _, r, e in results if e)
+         
+         print(f&quot;Total files processed: {len(results)}&quot;)
+         print(f&quot;  Changed: {changed}&quot;)
+         print(f&quot;  Unchanged: {unchanged}&quot;)
+         print(f&quot;  Errors: {errors}&quot;)
+ 
+ 
+ if __name__ == &#39;__main__&#39;:
+     main()
+ 
```

</details>

</tool-use>

---

Perfect! I've created a complete implementation in `recipient_changer.py` that:

## Features:

1. **Detects ali.maung@* addresses** in TO, CC, or BCC fields
2. **Removes** any recipients matching that pattern
3. **Adds your default recipients**:
   - TO: Dilek.kursun@rolls-royce.com
   - CC: jan.becker@rolls-royce.com; thomas.lux@rolls-royce.com
   - BCC: michael.wuske@rolls-royce.com; tetiana.isakii@rolls-royce.com; shmaila.aslam@rolls-royce.com

## Usage Examples:

```bash
# Process the MSG file (overwrites original)
python outlook/recipient_changer.py outlook/RRD081-2024_handoff_2710251835.msg

# Dry run first to see what would change (recommended!)
python outlook/recipient_changer.py outlook/RRD081-2024_handoff_2710251835.msg --dry-run

# Save to a new file instead of overwriting
python outlook/recipient_changer.py outlook/RRD081-2024_handoff_2710251835.msg -o outlook/modified_message.msg

# Process multiple MSG files at once
python outlook/recipient_changer.py outlook/*.msg
```

## Before Running:

Make sure you have `pywin32` installed:

```bash
pip install pywin32
```

Would you like me to run a dry-run test on your `RRD081-2024_handoff_2710251835.msg` file first to see what changes would be made?

---

_**User (2025-10-27 16:55Z)**_

add flags for bulk change by passing a directory

---

_**Agent (model claude-4.5-sonnet, mode Agent)**_

I'll add support for bulk processing by passing a directory. Let me update the script:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **code_edit** ‚Ä¢ Edit file: outlook/recipient_changer.py</summary>

**Chunk 1**
Lines added: 32, lines removed: undefined

```diff
@@ -208,4 +208,36 @@
      }
  
+ 
+ def find_msg_files(directory, recursive=False):
+     &quot;&quot;&quot;
+     Find all .msg files in a directory.
+     
+     Args:
+         directory: Directory path to search
+         recursive: If True, search subdirectories recursively
+         
+     Returns:
+         list: List of .msg file paths
+     &quot;&quot;&quot;
+     msg_files = []
+     
+     if recursive:
+         # Recursive search
+         for root, dirs, files in os.walk(directory):
+             for file in files:
+                 if file.lower().endswith(&#39;.msg&#39;):
+                     msg_files.append(os.path.join(root, file))
+     else:
+         # Non-recursive search
+         try:
+             for item in os.listdir(directory):
+                 item_path = os.path.join(directory, item)
+                 if os.path.isfile(item_path) and item.lower().endswith(&#39;.msg&#39;):
+                     msg_files.append(item_path)
+         except (OSError, PermissionError) as e:
+             print(f&quot;Error accessing directory {directory}: {e}&quot;)
+     
+     return sorted(msg_files)
+ 
  
  def main():
```

**Chunk 2**
Lines added: 19, lines removed: 2

```diff
@@ -228,13 +260,30 @@
    
    # Process all MSG files in a directory
-   python recipient_changer.py outlook/*.msg
+   python recipient_changer.py -d outlook/
+   
+   # Process all MSG files in a directory recursively
+   python recipient_changer.py -d outlook/ --recursive
+   
+   # Process multiple specific files
+   python recipient_changer.py file1.msg file2.msg file3.msg
          &quot;&quot;&quot;
      )
      
      parser.add_argument(
          &#39;msg_files&#39;,
-         nargs=&#39;+&#39;,
+         nargs=&#39;*&#39;,
          help=&#39;Path to .msg file(s) to process&#39;
      )
+     
+     parser.add_argument(
+         &#39;-d&#39;, &#39;--directory&#39;,
+         help=&#39;Directory containing .msg files to process&#39;
+     )
+     
+     parser.add_argument(
+         &#39;-r&#39;, &#39;--recursive&#39;,
+         action=&#39;store_true&#39;,
+         help=&#39;Process .msg files in subdirectories recursively (requires -d/--directory)&#39;
+     )
      
      parser.add_argument(
```

**Chunk 3**
Lines added: 39, lines removed: 2

```diff
@@ -251,12 +300,49 @@
      args = parser.parse_args()
      
+     # Collect all files to process
+     files_to_process = []
+     
+     if args.directory:
+         # Process directory
+         if not os.path.isdir(args.directory):
+             print(f&quot;Error: Directory not found: {args.directory}&quot;)
+             sys.exit(1)
+         
+         print(f&quot;Scanning directory: {args.directory}&quot;)
+         if args.recursive:
+             print(&quot;  (recursive mode)&quot;)
+         
+         files_to_process = find_msg_files(args.directory, args.recursive)
+         
+         if not files_to_process:
+             print(f&quot;No .msg files found in {args.directory}&quot;)
+             sys.exit(0)
+         
+         print(f&quot;Found {len(files_to_process)} .msg file(s)\n&quot;)
+     
+     elif args.msg_files:
+         # Process specified files
+         files_to_process = args.msg_files
+     
+     else:
+         # No files or directory specified
+         parser.print_help()
+         sys.exit(1)
+     
      # Validate arguments
-     if args.output and len(args.msg_files) &gt; 1:
+     if args.output and len(files_to_process) &gt; 1:
          print(&quot;Error: --output can only be used with a single input file&quot;)
          sys.exit(1)
      
+     if args.recursive and not args.directory:
+         print(&quot;Error: --recursive requires --directory&quot;)
+         sys.exit(1)
+     
      # Process each file
      results = []
-     for msg_file in args.msg_files:
+     for i, msg_file in enumerate(files_to_process, 1):
+         if len(files_to_process) &gt; 1:
+             print(f&quot;\n[{i}/{len(files_to_process)}]&quot;)
+         
          try:
              result = change_msg_recipients(
```

**Chunk 4**
Lines added: 14, lines removed: undefined

```diff
@@ -284,4 +370,18 @@
          print(f&quot;  Unchanged: {unchanged}&quot;)
          print(f&quot;  Errors: {errors}&quot;)
+         
+         # List changed files
+         if changed &gt; 0:
+             print(&quot;\nFiles with changes:&quot;)
+             for file, result, error in results:
+                 if result and result.get(&#39;changed&#39;):
+                     print(f&quot;  ‚úì {file}&quot;)
+         
+         # List files with errors
+         if errors &gt; 0:
+             print(&quot;\nFiles with errors:&quot;)
+             for file, result, error in results:
+                 if error:
+                     print(f&quot;  ‚ùå {file}: {error}&quot;)
  
  
```

</details>

</tool-use>

---

Perfect! I've added bulk processing support with directory scanning. Here are the new features:

## New Directory Processing Options:

### **`-d, --directory`** flag
Process all .msg files in a specified directory:
```bash
# Process all MSG files in the outlook directory
python outlook/recipient_changer.py -d outlook/

# Dry run on all MSG files in a directory
python outlook/recipient_changer.py -d outlook/ --dry-run
```

### **`-r, --recursive`** flag
Search subdirectories recursively (requires `-d`):
```bash
# Process all MSG files in outlook/ and all subdirectories
python outlook/recipient_changer.py -d outlook/ --recursive

# Dry run with recursive search
python outlook/recipient_changer.py -d outlook/ -r --dry-run
```

## All Usage Examples:

```bash
# Single file
python outlook/recipient_changer.py outlook/message.msg

# Single file with output to new location
python outlook/recipient_changer.py outlook/message.msg -o outlook/modified.msg

# Dry run on single file
python outlook/recipient_changer.py outlook/message.msg --dry-run

# Process entire directory
python outlook/recipient_changer.py -d outlook/

# Process directory recursively
python outlook/recipient_changer.py -d outlook/ --recursive

# Multiple specific files
python outlook/recipient_changer.py file1.msg file2.msg file3.msg

# Directory dry run (recommended before actual changes!)
python outlook/recipient_changer.py -d outlook/ --dry-run
```

## Enhanced Summary Report:

When processing multiple files, you'll get a detailed summary showing:
- Total files processed
- How many were changed
- How many were unchanged (no ali.maung@* found)
- Any errors encountered
- List of changed files
- List of files with errors

Would you like to test it with a dry run on the outlook directory?

---

_**User (2025-10-27 16:55Z)**_



---

_**Agent (model claude-4.5-sonnet, mode Agent)**_

Great! The dry run is working perfectly! I can see from the terminal output that:

1. ‚úÖ **It's correctly detecting** ali.maung@rolls-royce.com in TO, CC, and BCC fields
2. ‚úÖ **It's skipping files** that already have the correct recipients (like RRD006-2024)
3. ‚úÖ **It's showing what would be changed** without actually modifying the files

The script found 27 MSG files in your directory and is processing them all. From the sample output:

---

